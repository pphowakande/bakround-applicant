
from bakround_applicant.all_models.db import Job, Profile, ProfileReverseLookup
from bakround_applicant.services.notificationservice.util import get_facebook_profiles_for_profile
import pytest

PIPL_EXAMPLE = \
"{    \"@http_status_code\": 200,     \"@visible_sources\": 10,     \"@available_sources\": 230,     \"@persons_count\": 1,     \"@search_id\": \"1709191852471802675471537796443429103\",     \"query\": {        \"names\": [            {                \"first\": \"Rachael\",                 \"last\": \"Hafer\",                 \"display\": \"Rachael Hafer\"            }        ],         \"addresses\": [            {                \"country\": \"US\",                 \"state\": \"NJ\",                 \"city\": \"Laurel Springs\",                 \"display\": \"Laurel Springs, New Jersey\"            }        ]    },     \"available_data\": {        \"premium\": {            \"relationships\": 3,             \"usernames\": 2,             \"jobs\": 1,             \"addresses\": 1,             \"phones\": 2,             \"mobile_phones\": 2,             \"languages\": 1,             \"user_ids\": 3,             \"social_profiles\": 2,             \"names\": 1,             \"dobs\": 1,             \"images\": 2,             \"genders\": 1,             \"emails\": 1        }    },     \"person\": {        \"@id\": \"2997ee5c-dfb6-42e8-b724-367c20452744\",         \"@match\": 1.0,         \"@search_pointer\": \"ccb194594963ed0e7796370934a0b934d1fa767918acb5b07a65209dc73834db878230a49a9ac8007cfa0474f273e103b1bd8cae8091227c6d49ae870617afb91d8be549a1ff639f71155f584de1acd89f5bee5e2d7e9e5097b3873240f15384a94c1b5ffbbc1013184ac3a64885d6600743587c3c72caf8ec118322afe1fb708568c0f57b3b2c63f5cb4a3abd8ab0d8faca6b7f016cffdf83442af37a918a0d8aa97671ee0d44ec027a3b3e8304e7d92ee7994750c216412cd3bbda7027896ea1416d22002330eb8ff0e9c2ccb82f77a9ada44f99989673ca8540d5f45d52c2fc2b01516f5242ce549c926f97b1a927d7ab26f1ed07ee5ec8d5beac11de565e8c064f9c40c1ceac040991bd42c91b4f5399f5c4602306b6ad4b934c3085219df20033cf63f06502ca275056d511745ee6971a2949afa616058d5cb454acfba95a412d1fc8634ac0b2e5c0b7434e8cd5a2a44f479addc6c45ace434dd82dfac973e9d4ae00e7b1df7b2fdc56846f4a8189745345bad7da04b0d9e790e334bc30af1cf3372efab653c295b5968f1a11e97f09ba8d706e370377537f5f522c8181840c6295c57806c93b1f5978950e2f23d7eadec19ecdc8dc3a23ae380b89b2fd3d4a53d1f12ea814e75106fa8b2606974cf518cb935a6bc64c355cbe35e3ee48537385c891f92d332a98be6b58d3e1491b9703e232fe2767267dedf41b2ece460ca80f6b488cfd2867193701f0418b36ce4f28e60e95b28a1fba0bdfb7ff0811c07ecf660bb6e0eacba31a0a4b90ca4be9f259be1c15cea233897407fdfb25900de1fe5208adde5be7a2c83abf38a3f1d6409e5200347e3d9125e87ef06823e804db579b71dba696229aebad6ec259ed98e39935b44771a9ce277e34a1728acd956184429b8a2a40c748cb4d898d6d2adc2f149bc77a13caf388efb1357bbdfd5afb681b469de6fef9623c41065216d42079be98cb942cc57bb5af3d2694008d8991cd54b7d3be4540bb6292ab4ae52e10c00e3c4f080fef1e01419ee2fc27d7cfa3fd707168a27820b921bb7815aa5cc01111a4878b31914a9378604318d1c326d758be2ca273f5a75992e1a23bf015159db0d2aa074eacef48906914f8ba5a61273741a601409a20ffc5b38a1bb29029940849a559a2cf0d9a89e38943d9a46c7621afafa61eda9c98ec93c66cdc750ea85b53be67ac943ce5395384a45b57b511d57a8c6e63e4c0fc2e8aac7b246a644343baf232b11b9f52fd4ee76c76758d12e74bde1fc76b7a44951fd08b1fc029cb598380d0a05aff18dc97823b0e82c93669c970821e9ecf2a67c0379fb2a5df56c919c8fb167019f95092bf29ad2b85d3780c3e3b26363f9a1d51dc521092420e66847e37d9e938ea82303e5680e919e3ca49d9aeb8862cf98a0bc052485c78c969ecb9b790dbad236ef23a834d506e55493e3ba7830af78f73623db3f5f8798cd267c424bb853754a7ae56aaa71a996d98abaefad09b5357fbb0b50af610aa1b01f3927a9baf2bb424327a97914eb9a83f770141a3056e20d69cd779347d2703a5124d88c305b1ee2ab404defbc4ccb996ff5a5657e9cc30c404dd6fc9aa72c08b2cf105e02e5271439d7d0beb65c53f1ed5fb44f4d8c79aa6df53f057539e82e5a6013d7ee54ca4e9a9eb53f03a0a7dec84567b379c4a9c31646dcd1d13af5b9ab296983d11d383afa8978c4af5ac065a14d3e72127359740bcad2bbfa03ab411fe53cd00bc053879df298c190cd9fd450ea366268e3d13bc9c974943fd56d01494a36021c2c84d616231773ca7c717173a28deaf21f5a3bf09302298d181e9620c6fff4286d5a7b6854c0b02f2830934176f4ddbcebae36b978b58252cabfd5edb90682716a57104687a44e280668dbbb450b0abbcff134f114c9a9f796c73e2d95116bea895a38f6af9070677f814898bd91190316a8e39e82d06f9e85889a6a9aea9b4ab3028748da428e94fc31ebbe1d0ce17c51c2e598bc3ef4988a73e88e1bdc9e12e715dd148cef45ab167776ea1b33c2835c020184a359479e3e8f215d4d2f73bdeb055f33fc4424471c21d568b238817722b317096077c39e3b2b8a4352c18add8868d7cd319f70befb7de567e37ec4326af676eb5a54ef1fe2ffe5394e2c81d961e18eab9f7e9ea60\",         \"names\": [            {                \"@valid_since\": \"2011-10-27\",                 \"@last_seen\": \"2016-01-01\",                 \"prefix\": \"Ms\",                 \"first\": \"Rachael\",                 \"middle\": \"M\",                 \"last\": \"Hafer\",                 \"display\": \"Rachael M Hafer\"            }        ],         \"emails\": [            {                \"@valid_since\": \"2011-10-27\",                 \"@last_seen\": \"2016-02-03\",                 \"@email_provider\": false,                 \"address\": \"rhafer@ehafer.com\",                 \"address_md5\": \"df6324e45f09e582a58635eeca0f2e50\"            }        ],         \"usernames\": [            {                \"@valid_since\": \"2011-10-27\",                 \"@last_seen\": \"2016-02-03\",                 \"content\": \"rachael.hafer.5\"            },             {                \"@valid_since\": \"2012-05-19\",                 \"content\": \"rachaelhafer\"            }        ],         \"phones\": [            {                \"@valid_since\": \"2013-10-28\",                 \"@last_seen\": \"2016-02-03\",                 \"@type\": \"mobile\",                 \"country_code\": 1,                 \"number\": 8564497745,                 \"display\": \"856-449-7745\",                 \"display_international\": \"+1 856-449-7745\"            },             {                \"@valid_since\": \"2016-01-01\",                 \"@last_seen\": \"2016-01-01\",                 \"@type\": \"mobile\",                 \"country_code\": 1,                 \"number\": 8565779388,                 \"display\": \"856-577-9388\",                 \"display_international\": \"+1 856-577-9388\"            }        ],         \"gender\": {            \"@valid_since\": \"2011-10-27\",             \"@last_seen\": \"2016-01-01\",             \"content\": \"female\"        },         \"dob\": {            \"date_range\": {                \"start\": \"1993-09-20\",                 \"end\": \"1993-12-31\"            },             \"display\": \"23 years old\"        },         \"languages\": [            {                \"@inferred\": true,                 \"region\": \"US\",                 \"language\": \"en\",                 \"display\": \"en_US\"            }        ],         \"addresses\": [            {                \"@valid_since\": \"2013-10-28\",                 \"@last_seen\": \"2016-02-03\",                 \"country\": \"US\",                 \"state\": \"NJ\",                 \"city\": \"Laurel Springs\",                 \"street\": \"Park Avenue\",                 \"house\": \"603\",                 \"zip_code\": \"08021\",                 \"display\": \"603 Park Avenue, Laurel Springs, New Jersey\"            }        ],         \"jobs\": [            {                \"@inferred\": true,                 \"organization\": \"eric l hafer assoc pa\",                 \"display\": \"eric l hafer assoc pa\"            }        ],         \"relationships\": [            {                \"@type\": \"family\",                 \"names\": [                    {                        \"first\": \"Eric\",                         \"middle\": \"Leigh\",                         \"last\": \"Hafer\",                         \"display\": \"Eric Leigh Hafer\"                    }                ]            },             {                \"@type\": \"family\",                 \"names\": [                    {                        \"first\": \"Sarah\",                         \"middle\": \"Anne\",                         \"last\": \"Hafer\",                         \"display\": \"Sarah Anne Hafer\"                    }                ]            },             {                \"@type\": \"family\",                 \"names\": [                    {                        \"first\": \"Dianne\",                         \"middle\": \"L\",                         \"last\": \"Hambel-Hafer\",                         \"display\": \"Dianne L Hambel-hafer\"                    }                ]            }        ],         \"user_ids\": [            {                \"@valid_since\": \"2012-05-19\",                 \"content\": \"286946664@twitter\"            },             {                \"@valid_since\": \"2012-05-19\",                 \"content\": \"1181065200@twitter\"            },             {                \"@valid_since\": \"2011-10-27\",                 \"@last_seen\": \"2016-02-03\",                 \"content\": \"100000446901950@facebook\"            }        ],         \"images\": [            {                \"@valid_since\": \"2012-05-19\",                 \"url\": \"http://pbs.twimg.com/profile_images/2224972848/image.jpg\",                 \"thumbnail_token\": \"AE2861B242686E7DDBDF0D814A3486E1D19BE9609F41B4AA71B6D0FEB03454A84C36C69AC48FE965679DC5294025CD4D341254E7F057871D859D624504151260FD9DC4\"            },             {                \"@valid_since\": \"2011-10-27\",                 \"@last_seen\": \"2016-02-03\",                 \"url\": \"http://graph.facebook.com/100000446901950/picture?type=large\",                 \"thumbnail_token\": \"AE2861B242686E6ACBCD539D133B8AE59A9AE962DB1FA5AA7AF08DABDF6D09F91F67838CC68CE2646E858778176997563C4C47FBAE58CA16C28B7649464C5230A194C53600E278\"            }        ],         \"urls\": [            {                \"@source_id\": \"0b59a5618813f9a0cdb8886f0aeae11f\",                 \"@domain\": \"twitter.com\",                 \"@name\": \"Twitter\",                 \"@category\": \"personal_profiles\",                 \"url\": \"http://www.twitter.com/RachaelHafer\"            },             {                \"@source_id\": \"fb939856010e486a317a56db1409873e\",                 \"@domain\": \"facebook.com\",                 \"@name\": \"Facebook\",                 \"@category\": \"personal_profiles\",                 \"url\": \"http://www.facebook.com/people/_/100000446901950\"            },             {                \"@source_id\": \"1136ab2fba0f613f4cc6d27dc1dc20e6\",                 \"@domain\": \"klout.com\",                 \"@name\": \"klout\",                 \"@category\": \"personal_profiles\",                 \"url\": \"http://klout.com/RachaelHafer\"            },             {                \"@source_id\": \"b7f4d65764c0578ad560d3c64f12d1d1\",                 \"@sponsored\": true,                 \"@domain\": \"tracking.instantcheckmate.com\",                 \"@name\": \"Instant Checkmate\",                 \"@category\": \"background_reports\",                 \"url\": \"http://tracking.instantcheckmate.com/?a=60&oc=5&c=148&s1=Mshortcut_results&s2=3&fname=Rachael&lname=Hafer&city=Laurel Springs&state=NJ&src=pipl&mdm=api&cmp=SB_MultiR&s1=SB_MultiR&s4=results\"            },             {                \"@source_id\": \"23a2201243a2cc3358a42756b0b9a508\",                 \"@sponsored\": true,                 \"@domain\": \"spokeo.com\",                 \"@name\": \"Spokeo (Name Search)\",                 \"@category\": \"contact_details\",                 \"url\": \"http://www.spokeo.com/First-Last/State/City/p40179886610?idx=&piplstart=&g=name_pt_pipl_scd01_tg02_\"            },             {                \"@valid_since\": \"2014-01-01\",                 \"@last_seen\": \"2016-02-03\",                 \"@domain\": \"facebook.com\",                 \"@category\": \"personal_profiles\",                 \"url\": \"http://www.facebook.com/rachael.hafer.5\"            }        ]    }}"


@pytest.mark.django_db
def test_pipl_facebook_profiles():
    job = Job()
    job.save()

    profile = Profile(job=job)
    profile.save()

    ProfileReverseLookup(profile=profile, provider='pipl', output=PIPL_EXAMPLE).save()

    fb_profiles = get_facebook_profiles_for_profile(profile)
    assert len(fb_profiles) == 2
